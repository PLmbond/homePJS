var fs = require('fs'), path = require('path');

// Look for binary for this platform
var modPath = path.join(__dirname, 'bin', process.platform + '_' + process.arch + '_' + process.version.split('.')[0], 'loader');

try {
	fs.statSync(modPath + '.node');
} catch (ex) {
	// No binary!
	console.error(
		'## There is an issue with `pjsloader` ##\n'+
		'`' + modPath + '.node` is missing.\n\n'+
		'Try running this to fix the issue: '+ process.execPath+ ' '+ __dirname.replace(' ', '\\ ') + '/build'
	);
	throw new Error('Missing binary. See message above.');
}

// Pull in loader implementation
module.exports = require(modPath).Loader;
